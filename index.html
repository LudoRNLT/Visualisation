<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniStudio Sovereign - Celestial Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <link rel="stylesheet" href="index.css">
</head>
<body>

<div id="tooltip-3d" class="tooltip-3d"></div>

<div id="helpModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="toggleHelp()">&times;</span>
        <h2 style="margin-top:0; color: var(--primary);">Guide OmniStudio</h2>
        
        <div class="help-list">
            <div>ğŸ“¥ <strong>Import :</strong> Choisissez un <em>Sample</em> ou importez votre fichier (CSV/JSON) dans le volet 1.</div>
            <div>âš™ï¸ <strong>Config :</strong> Filtrez vos donnÃ©es (volet 2) et dÃ©finissez vos axes X/Y (volet 3).</div>
            <div>ğŸ“Š <strong>Vue :</strong> Changez de mode (Barres, Nuage, 3D, Galerie...) via les icÃ´nes du volet 5.</div>
            <div>ğŸŒ“ <strong>Style :</strong> Ajustez les couleurs ou passez en <em>Mode Sombre</em> via le Header.</div>
            <div>ğŸ’¾ <strong>Export :</strong> TÃ©lÃ©chargez votre rÃ©sultat en PNG ou SVG via le volet 6.</div>
        </div>

        <p style="font-size: 11px; color: #95a5a6; border-top: 1px solid #eee; padding-top: 10px;">
            * En mode <strong>3D</strong>, naviguez entre les donnÃ©es avec les flÃ¨ches ou le clavier.
        </p>

        <button class="btn-main" onclick="toggleHelp()" style="margin-top:15px; font-weight:800;">FERMER</button>
    </div>
</div>

<div class="header">
    <div class="header-logo"><strong>OMNISTUDIO</strong></div>
    <div class="header-actions">
        <button onclick="toggleHelp()" class="btn-head-action">â“ Aide</button>
        <button onclick="document.body.classList.toggle('dark')" class="btn-head-action">ğŸŒ— Mode</button>
        <button onclick="location.reload()" class="btn-head-action btn-reset">Reset</button>
    </div>
</div>

<div class="stats-bar">
    <div>ğŸ“Š Ã‰lÃ©ments: <span id="st-count" class="stat-highlight">0</span></div>
    <div>ğŸ“ˆ Max: <span id="st-max" class="stat-highlight">0</span></div>
    <div id="msg" style="margin-left:auto; font-weight:bold; color:#27ae60;"></div>
</div>

<div class="main">
    <div class="sidebar">
        
        <details open>
            <summary class="section-title">0. Jeux de donnÃ©es d'exemples</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <div class="example-grid">
                        <button class="btn-example" onclick="loadLocalCSV('FRvideos.csv')">ğŸ“ YouTube FR</button>
                        <button class="btn-example" onclick="loadLocalCSV('netflix_titles.csv')">ğŸ“ Netflix</button>
                        <button class="btn-example" onclick="loadLocalCSV('StudentsPerformance.csv')">ğŸ“ Ã‰tudiants</button>
                        <button class="btn-example" onclick="loadLocalCSV('vgsales.csv')">ğŸ“ Jeux VidÃ©o</button>
                    </div>
                </div>
            </div>
        </details>

        <details>
            <summary class="section-title">1. Source de donnÃ©es</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <label class="input-label">Provenance :</label>
                    <select id="src-type" onchange="toggleIn(this.value)">
                        <option value="csv">Fichier Local</option>
                        <option value="sparql">RequÃªte SPARQL</option>
                    </select>
                    <div id="zone-f">
                        <input type="file" id="f-upload" accept=".csv,.tsv,.txt,.json">
                    </div>
                    <div id="zone-s" style="display:none;">
                        <textarea id="q-sparql" placeholder="SELECT..."></textarea>
                        <button class="btn-main" onclick="runSparql()">Run</button>
                    </div>
                </div>
            </div>
        </details>

        <details>
            <summary class="section-title">2. Recherche & Filtrage</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <label class="input-label">Chercher un mot :</label>
                    <input type="text" id="f-search" placeholder="ğŸ” Rechercher..." oninput="refresh()">
                    <label class="input-label">QuantitÃ© Ã  afficher :</label>
                    <input type="range" id="l-num" min="5" max="200" value="20" oninput="refresh()">
                </div>
            </div>
        </details>

        <details open>
            <summary class="section-title">3. Configuration des Axes</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <label class="input-label">Trier par :</label>
                    <select id="sort-type" onchange="refresh()">
                        <option value="desc">Valeur (DÃ©croissant)</option>
                        <option value="asc">Valeur (Croissant)</option>
                        <option value="name-asc">Nom (A-Z)</option>
                    </select>
                    <div class="axes-config">
                        <div style="flex:1">
                            <label class="input-label">Axe X (Valeur) :</label>
                            <select id="ax-x" onchange="refresh()"></select>
                        </div>
                        <div style="flex:1">
                            <label class="input-label">Axe Y (Nom) :</label>
                            <select id="ax-y" onchange="refresh()"></select>
                        </div>
                    </div>
                </div>
            </div>
        </details>
        
        <details>
            <summary class="section-title">4. Style visuel</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <div class="style-row">
                        <div style="flex:0 0 50px">
                            <label class="input-label">Couleur :</label>
                            <input type="color" id="c-pick" value="#3498db" oninput="refresh()">
                        </div>
                        <div style="flex:1">
                            <label class="input-label">Palette :</label>
                            <select id="c-scheme" onchange="refresh()">
                                <option value="single">Unique</option>
                                <option value="viridis">Viridis</option>
                                <option value="magma">Magma</option>
                                <option value="tableau10">Tableau</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <details open>
            <summary class="section-title">5. Visualisations</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <div class="chart-grid">
                        <button class="c-btn active" data-type="bar">ğŸ“Š <small>Bar</small></button>
                        <button class="c-btn" data-type="pie">ğŸ• <small>Pie</small></button>
                        <button class="c-btn" data-type="scatter">ğŸ¯ <small>Points</small></button>
                        <button class="c-btn" data-type="cloud">â˜ï¸ <small>Cloud</small></button>
                        <button class="c-btn" data-type="line">ğŸ“ˆ <small>Lines</small></button>
                        <button class="c-btn" data-type="3d">ğŸ§Š <small>3D</small></button>
                        <button class="c-btn" data-type="table">ğŸ“‹ <small>Table</small></button>
                        <button class="c-btn" data-type="gallery">ğŸ–¼ï¸ <small>Gallery</small></button>
                    </div>
                </div>
            </div>
        </details>

        <details>
            <summary class="section-title">6. Exports</summary>
            <div class="details-content">
                <div class="details-wrapper">
                    <div class="export-grid">
                        <button class="btn-export" style="background:#2f6fc8" onclick="exportPNG()">PNG</button>
                        <button class="btn-export" style="background:#8e44ad" onclick="exportSVG()">SVG</button>
                        <button class="btn-export" style="background:#27ae60" onclick="exportCSVFiltered()">CSV</button>
                    </div>
                </div>
            </div>
        </details>
    </div>

    <div class="content">
        <div id="vis-box">
            <div id="vis"></div>
            <div id="three-canvas" style="display:none;"></div>
        </div>
        <div id="extra-output"></div>
    </div>
</div>

<script src="index.js"></script>
</body>
</html>
