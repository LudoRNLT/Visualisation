<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>OmniStudio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <link rel="stylesheet" href="index.css">
</head>
<body>

<div id="helpModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="toggleHelp()">&times;</span>
        <h2 style="margin-top:0;">ğŸ“– Guide d'utilisation</h2>
        <div class="help-step"><strong>1. Charger :</strong> Boutons <em>Exemples</em> ou import.</div>
        <div class="help-step"><strong>2. Mapper :</strong> Choisissez Axe X (Valeur) et Axe Y (Nom).</div>
        <div class="help-step"><strong>3. Visualiser :</strong> Choisissez un type de visualisation.</div>
        <div class="help-step"><strong>4. Exporter :</strong> Sauvegardez vos travaux en PNG, SVG ou en CSV filtrÃ©.</div>
        <button class="btn-main" onclick="toggleHelp()" style="margin-top:10px;">Compris !</button>
    </div>
</div>

<div class="header">
    <div style="display:flex; align-items:center; gap:15px;">
        <strong>OMNISTUDIO</strong>
        <button onclick="toggleHelp()" style="width:auto; padding:5px 12px; background:#f39c12; color:white;">â“ Aide</button>
    </div>
    <div style="display:flex; gap:8px;">
        <button onclick="document.body.classList.toggle('dark')" style="width:auto; padding:5px 12px; border:1px solid white; background:transparent; color:white;">ğŸŒ— Mode</button>
        <button onclick="location.reload()" style="background:#e74c3c; color:white; width:auto; padding:5px 12px;">Reset</button>
    </div>
</div>

<div class="stats-bar">
    <div>Lignes: <span id="st-count" style="color:var(--primary)">0</span></div>
    <div>Max: <span id="st-max" style="color:var(--accent)">0</span></div>
    <div id="msg" style="margin-left:auto; color:#27ae60; font-weight:bold;"></div>
</div>

<div class="main">
    <div class="sidebar">
        <div class="section-title">Samples</div>
        <div class="example-grid">
            <button class="btn-example" onclick="loadLocalCSV('FRvideos.csv')">ğŸ“ French videos</button>
            <button class="btn-example" onclick="loadLocalCSV('netflix_titles.csv')">ğŸ“ Netflix titles</button>
            <button class="btn-example" onclick="loadLocalCSV('StudentsPerformance.csv')">ğŸ“ Students performance</button>
            <button class="btn-example" onclick="loadLocalCSV('vgsales.csv')">ğŸ“ Videogames sales</button>
        </div>

        <div class="section-title">Data</div>
        <select id="src-type" onchange="toggleIn(this.value)">
            <option value="csv">Fichier Local</option>
            <option value="sparql">RequÃªte SPARQL</option>
        </select>
        <div id="zone-f"><input type="file" id="f-upload" accept=".csv,.tsv,.txt,.json"></div>
        <div id="zone-s" style="display:none;"><textarea id="q-sparql" placeholder="SELECT..."></textarea><button class="btn-main" onclick="runSparql()">Run</button></div>

        <div class="section-title">Recherche</div>
        <input type="text" id="f-search" placeholder="ğŸ” Rechercher..." oninput="refresh()">
        <input type="range" id="l-num" min="5" max="200" value="20" oninput="refresh()">

        <div class="section-title">Configuration</div>
        <select id="sort-type" onchange="refresh()">
            <option value="desc">Valeur (DÃ©croissant)</option>
            <option value="asc">Valeur (Croissant)</option>
            <option value="name-asc">Nom (A-Z)</option>
        </select>
        <select id="ax-x" onchange="refresh()"></select>
        <select id="ax-y" onchange="refresh()"></select>
        
        <div class="section-title">Style visuel</div>
        <div style="display:flex; gap:10px; align-items:center;">
            <input type="color" id="c-pick" value="#3498db" oninput="refresh()">
            <select id="c-scheme" onchange="refresh()">
                <option value="single">Unique</option>
                <option value="viridis">Viridis</option>
                <option value="magma">Magma</option>
                <option value="tableau10">Tableau</option>
            </select>
        </div>

        <div class="section-title">Visualisations</div>
        <div class="chart-grid">
            <button class="c-btn active" data-type="bar">ğŸ“Š Bar</button>
            <button class="c-btn" data-type="pie">ğŸ• Pie</button>
            <button class="c-btn" data-type="scatter">ğŸ¯ Points</button>
            <button class="c-btn" data-type="cloud">â˜ï¸ Cloud</button>
            <button class="c-btn" data-type="line">ğŸ“ˆ Line</button>
            <button class="c-btn" data-type="3d">ğŸ§Š 3D</button>
            <button class="c-btn" data-type="table">ğŸ“‹ Table</button>
            <button class="c-btn" data-type="gallery">ğŸ–¼ï¸ Galerie</button>
        </div>

        <div class="section-title">Exports</div>
        <div style="display:flex; flex-direction:column; gap:5px;">
            <div style="display:flex; gap:5px;">
                <button class="btn-main" onclick="exportPNG()">PNG</button>
                <button class="btn-main" style="background:#8e44ad" onclick="exportSVG()">SVG</button>
            </div>
            <button class="btn-main" style="background:#27ae60" onclick="exportCSVFiltered()">Export CSV FiltrÃ©</button>
        </div>
    </div>

    <div class="content">
        <div id="vis-box">
            <div id="vis"></div>
            <div id="three-canvas" style="display:none;"></div>
        </div>
        <div id="extra-output"></div>
    </div>
</div>

<script src="index.js"></script>
</body>
</html>